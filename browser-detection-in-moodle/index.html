<!DOCTYPE html>
<html>

<!-- Mirrored from 127.0.0.1:2368/browser-detection-in-moodle/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Mar 2015 01:51:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Browser Detection in Moodle - iyWare</title>
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../assets/favicon.ico">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.min8389.css?v=1282eb534a" />
    <link rel="canonical" href="https://iyware.com/browser-detection-in-moodle/" />
    
    <meta property="og:site_name" content="iyWare" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Browser Detection in Moodle" />
    <meta property="og:description" content="Once again I’ve been working away at adding new features to Zebra for Moodle 2. One of my big pushes, by request (though it’s been on my plate) is getting some sort of better support for Internet Explorer..." />
    <meta property="og:url" content="https://iyware.com/browser-detection-in-moodle/" />
    <meta property="article:published_time" content="2012-03-19T16:28:10.000Z" />
    <meta property="article:modified_time" content="2015-01-19T01:03:32.980Z" />
    <meta property="article:tag" content="Moodle" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Browser Detection in Moodle" />
    <meta name="twitter:description" content="Once again I’ve been working away at adding new features to Zebra for Moodle 2. One of my big pushes, by request (though it’s been on my plate) is getting some sort of better support for Internet Explorer..." />
    <meta name="twitter:url" content="https://iyware.com/browser-detection-in-moodle/" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "iyWare",
    "author": {
        "@type": "Person",
        "name": "Danny Wahl",
        "image": "https://iyware.com/content/images/2015/03/dannywahl.jpg",
        "url": "https://iyware.com/author/danny",
        "sameAs": "https://iyware.com"
    },
    "headline": "Browser Detection in Moodle",
    "url": "https://iyware.com/browser-detection-in-moodle/",
    "datePublished": "2012-03-19T16:28:10.000Z",
    "dateModified": "2015-01-19T01:03:32.980Z",
    "keywords": "Moodle",
    "description": "Once again I’ve been working away at adding new features to Zebra for Moodle 2. One of my big pushes, by request (though it’s been on my plate) is getting some sort of better support for Internet Explorer..."
}
    </script>

    <meta name="generator" content="Ghost 0.5" />
    <link rel="alternate" type="application/rss+xml" title="iyWare" href="https://iyware.com/rss/" />
</head>
<body class="post-template tag-moodle">
    

	<header role="banner" class="header-main no-image">
    		<ul class="nav">
    <li class="nav-home" role="presentation"><a href="https://iyware.com/">Home</a></li>
    <li class="nav-clients" role="presentation"><a href="https://iyware.com/clients/">Clients</a></li>
    <li class="nav-portfolio" role="presentation"><a href="https://iyware.com/tag/portfolio/">Portfolio</a></li>
    <li class="nav-search" role="presentation"><a href="https://iyware.com/search/">Search</a></li>
</ul>
		<h1>
    		<a href="https://iyware.com/">
            		<img src="../content/images/2015/01/logo.png" alt="iyWare">
			</a>
		</h1>
	</header>

    <article role="main" class="post tag-moodle" data-swiftype-index="true">
    
        <header>
            <h1>Browser Detection in Moodle</h1>

			<small class="meta">
						<a href="../author/danny/" class="author" style="background-image:url('../content/images/2015/03/dannywahl.jpg');"><img src="../content/images/2015/03/dannywahl.jpg" alt="Danny Wahl's picture"></a>
					<a href="../author/danny/">Danny Wahl</a>
				&nbsp;&bull;&nbsp;
				<time datetime="2012-03-20">March 20, 2012</time>
					&nbsp;&bull;&nbsp;
					<span class="tags"><a href="../tag/moodle/">Moodle</a></span>
			</small>
        </header>

        <div class="text">
            <p>Once again I’ve been working away at adding new features to Zebra for Moodle 2. One of my big pushes, by request (though it’s been on my plate) is getting some sort of better support for Internet Explorer 7 and 8. Which is actually pretty tough since they don’t support <code>@media</code> queries at all.</p>

<p>One option was to re-work the media query order from mobile-first to desktop-first, but that’s not fun. So I decided to use <a href="https://github.com/scottjehl/Respond" title="Respond.js github repository">respond.js</a>. According to the author respond.js is:</p>

<blockquote>
  <p>A fast &amp; lightweight polyfill for min/max-width CSS3 Media Queries (for IE 6-8, and more). The goal of this script is to provide a fast and lightweight (3kb minified / 1kb gzipped) script to enable responsive web designs in browsers that don’t support CSS3 Media Queries – in particular, Internet Explorer 8 and under.</p>
</blockquote>

<p>Which was exactly what I wanted. I love not re-inventing the wheel. At first I just threw it in the javascripts_footer() array and called it a day (it worked!). But then I got to thinking, why should I make good users with modern browsers suffer having to load this javascript just to not run it? So I decided to sniff out the browser. At first I tried using IE conditionals (e.g. <code>&lt;!--[if lt IE 9]&gt;blah blah blah…&lt;![endif]--&gt;</code>) but it turns out those do not play nice with php at all and a switch just got too big too fast.</p>

<p>Then I was reminded that Moodle already does browser detection and that the value is stored in the body classes. Turns out that Moodle actually stores two values: IE and IE# where # is the version (7, 8, etc…). With that knowledge it was fairly simple to serve respond.js to only those users. All I had to do was add the code to my page layout(s). In this example the variable <code>$userespond</code> is simply a value stored from the theme settings page – so an administrator can turn it off entirely.</p>

<pre><code class="language-php">// general.php
if ($userespond == 1) {  
    $usingie = strpos($PAGE-&gt;bodyclasses, 'ie ie');
    $usingie9 = strpos($PAGE-&gt;bodyclasses, 'ie9');
    if (($usingie !== false) &amp;&amp; ($usingie9 === false)) {
        $PAGE-&gt;requires-&gt;js('/theme/zebra/javascript/respond.js');
    }
}
</code></pre>

<p>That was pretty easy. So then I decided to do the same thing to load <a href="http://code.google.com/chrome/chromeframe/" title="Google Chrome Fram">Chrome Frame</a> as another option. In this example there are two variables. The first is <code>$usecf</code> which does the same thing as <code>$userespond</code> above, and the second is a max version of IE to target. So if you set it to “7” users on IE8 won’t see a prompt to install. The default is 6 by the way, and this is about as much “compatibility” as I plan to add for this theme with IE6.</p>

<pre><code class="language-php">// general.php
&lt;?php if ($usecf == 1) {  
    $ieversion = strpos($PAGE-&gt;bodyclasses, $cfmaxversion);
    if ($ieversion !== false) {
        $PAGE-&gt;requires-&gt;js(new moodle_url('http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js')); ?&gt;
        &lt;script&gt;
            //&lt;![CDATA[
                window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})
            //]]&gt;
        &lt;/script&gt;
    &lt;?php }
}
</code></pre>

<p>Then I remembered that for a while now I’ve had a javascript included in the footer that only fixes a viewport re-flow error on iOS, and I figured I should target that the same way. Unfortunately Moodle doesn’t store that information as easily, but it’s pretty straight forward information to get, since there are only three devices that use iOS.</p>

<pre><code class="language-php">// general.php
if (preg_match('/iPhone|iPod|iPad/i', $_SERVER['HTTP_USER_AGENT'])) {  
    $PAGE-&gt;requires-&gt;js('/theme/zebra/javascript/iOS-viewport-fix.js');
}
</code></pre>

<p>There, now I feel a lot better for all the Firefox (or Opera?) users out there. Instead of downloading and evaluating three javascripts that would do nothing on your browser, you get nothing! Now, I am fully aware that browser detection is not a great practice, for starters any one can change their user-agent and none of this would work. But, all 3 of these scripts are attempts at preventing degradation so if they don’t run the worst that happens is the user’s browser is as broken as it would have been if I hadn’t included the scripts at all.</p>
        </div>

        <section class="share">
        	<ul>
				<li>
					<a href="mailto:?&subject=iyWare%3A%20Browser%20Detection%20in%20Moodle&body=Browser%20Detection%20in%20Moodle%0D%0Ahttps://iyware.com/browser-detection-in-moodle/%0D%0A%0D%0AOnce again I’ve been working away at adding new features to Zebra for Moodle 2. One of my big pushes, by request (though it’s been on my plate) is getting some sort of better support for Internet Explorer 7 and 8. Which is%2E%2E%2E">Email</a>
				</li>
				<li>
					<a href="https://twitter.com/home?status=https://iyware.com/browser-detection-in-moodle/%20%23Moodle">Twitter</a>
				</li>
				<li>
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://iyware.com/browser-detection-in-moodle/">Facebook</a>
				</li>
				<li>
					<a href="https://plus.google.com/share?url=https://iyware.com/browser-detection-in-moodle/">Google+</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://iyware.com/browser-detection-in-moodle/&amp;title=Browser%20Detection%20in%20Moodle&amp;summary=Once%20again%20I%e2%80%99ve%20been%20working%20away%20at%20adding%20new%20features%20to%20Zebra%20for%20Moodle%202.%20One%20of%20my%20big%20pushes,%20by%20request%20(though%20it%e2%80%99s%20been%20on%20my%20plate)%20is%20getting%20some%20sort%20of%20better%20support%20for%20Internet%20Explorer%207%20and%208.%20Which%20is&amp;source=iyWare">LinkedIn</a>
				</li>
				















			</ul>
        </section>

        <footer class="post-footer vcard cf" role="contentinfo">
                	<div class="wrapper">
                	<a href="../author/danny/" class="author" style="background-image: url('../content/images/2015/03/dannywahl.jpg');">
                    	<img src="../content/images/2015/03/dannywahl.jpg" alt="Danny Wahl">
					</a>
					</div>
                <div class="author-info meta">
					<a href="../author/danny/" class="fn">Danny Wahl</a>
                    &nbsp;&bull;&nbsp;<span class="adr">天津</span>
                    &nbsp;&bull;&nbsp;<a class="site" href="https://iyware.com/">https://iyware.com</a>
                    <p class="bio">My name is Danny Wahl and I provide IT management and consulting in the APAC region. I dabble in writing, programming, design, and ukulele playing. Post content licensed CC-BY-4.0</p>
                </div>
        </footer>
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		var disqus_shortname = 'iyware';
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>
		<p style="text-align:center;">
			<small>Please enable JavaScript to view the <a href="https://disqus.com/home/forums/iyware/">comments powered by Disqus.</a></small>
		</p>
	</noscript>
	
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<ins class="adsbygoogle" style="display:block;width:320px;height:100px;margin:0 auto;" data-ad-client="ca-pub-5811335018322110" data-ad-slot="8562617448"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>  

    </article>
  

<footer class="footer-main cf">
	<p class="feed"><a href="https://iyware.com/rss">RSS Feed</a></p>
	<p class="description">
        <a class="title" href="https://iyware.com/">iyWare</a>
        <span>Things I Break</span>
    </p>
	<p class="copyright">&copy; 2015 <a href="https://iyware.com/">iyWare</a></p>
</footer>
    <script src="../public/jquery8389.js?v=1282eb534a"></script>

		<script type="text/javascript" src="../assets/js/prism.min8389.js?v=1282eb534a"></script>
	
	<script type="text/javascript" src="../assets/js/jquery.swiftype.min8389.js?v=1282eb534a"></script>
	<script type="text/javascript">
		$('<li class="nav-search-form"><form action="#" onsubmit="stSearch();return false;" autocomplete="on"><label id="nav-search-label" for="st-search-input">Search:</label><input id="search_submit" value="Search" type="submit"><input id="st-search-input" name="search" type="text" placeholder="search https://iyware.com"></form></li>').insertAfter(".nav-search");

		var stSearch = function(){
			var query = document.getElementById("st-search-input").value;
			window.location.href = "/search/#stq=" + query + "&stp=1";
		};

		var stAutoRenderFunction = function(document_type, item) {
			var titleEnd = item['title'].length - 9;
			var title = item['title'].substring(0,titleEnd);
			return '<p class="title">' + title + '</p>';
		};

		var stRenderFunction = function(documentType, item) {
			var titleEnd = item['title'].length - 9;
			var title = item['title'].substring(0,titleEnd);
			var header = '<header><h2><a class="st-search-result-link" href="' + item['url'] + '">' + title + '</a></h2></header>'
			var text = '<div class="text"><p>' + item['body'].substring(20,250) + '</p></div>';
			var continueReading = '<small class="continue"><a href="' +  item['url'] + '">Continue Reading</a></small>';
			return '<div class="loop"><article>' + header + text + continueReading + '</article></div>';
		};

		$("#st-search-input").swiftype({
			renderFunction: stAutoRenderFunction,
			resultLimit: 5,
			engineKey:"sg3kn6rAnozjxvM4k8nk"
		});
		$("#st-search-input").swiftypeSearch({
			renderFunction:stRenderFunction,
			perPage:4,
			engineKey:"sg3kn6rAnozjxvM4k8nk",
			resultContainingElement:"#st-results-container"
		});
		$("#st-search-input2").swiftype({
			renderFunction: stAutoRenderFunction,
			resultLimit: 5,
			engineKey: "sg3kn6rAnozjxvM4k8nk"
		});
		$("#st-search-input2").swiftypeSearch({
			renderFunction:stRenderFunction,
			perPage:4,
			engineKey:"sg3kn6rAnozjxvM4k8nk",
			resultContainingElement:"#st-results-container"
		});
	</script>
	<aside style="display:none;">
		<a href="../search/">search</a>
		<a href="../clients/">clients</a>
	</aside>
</body>

<!-- Mirrored from 127.0.0.1:2368/browser-detection-in-moodle/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Mar 2015 01:51:54 GMT -->
</html>
