<!DOCTYPE html>
<html>

<!-- Mirrored from localhost:2368/re-writing-good-code/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 04 Feb 2015 05:45:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>iyWare | (Re-)Writing Good Code</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.mina8c1.css?v=81e7bb23cf" />

    <link rel="canonical" href="http://iyware.com/re-writing-good-code/" />
    
    <meta property="og:site_name" content="iyWare" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="(Re-)Writing Good Code" />
    <meta property="og:description" content="A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s..." />
    <meta property="og:url" content="http://iyware.com/re-writing-good-code/" />
    <meta property="article:published_time" content="2011-11-05T14:39:53.000Z" />
    <meta property="article:modified_time" content="2015-01-19T03:13:04.630Z" />
    <meta property="article:tag" content="DevOps" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="(Re-)Writing Good Code" />
    <meta name="twitter:description" content="A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s..." />
    <meta name="twitter:url" content="http://iyware.com/re-writing-good-code/" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "iyWare",
    "author": {
        "@type": "Person",
        "name": "Danny Wahl",
        "image": "http://iyware.com/content/images/2015/01/me.jpg",
        "url": "http://iyware.com/author/danny",
        "sameAs": null
    },
    "headline": "(Re-)Writing Good Code",
    "url": "http://iyware.com/re-writing-good-code/",
    "datePublished": "2011-11-05T14:39:53.000Z",
    "dateModified": "2015-01-19T03:13:04.630Z",
    "keywords": "DevOps",
    "description": "A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s..."
}
    </script>

    <meta name="generator" content="Ghost 0.5" />
    <link rel="alternate" type="application/rss+xml" title="iyWare" href="http://iyware.com/rss/" />
</head>
<body class="post-template tag-devops  noimage">

    


    <article role="main" class="">
        <header class="group">
            <a href="../index.html" id="home_link">«</a>
            <div class="hgroup">
            	<h1>(Re-)Writing Good Code</h1>
            	<div class="meta">
            		<time datetime="2011-11-05">November 05, 2011</time>
            		&nbsp;&bull;&nbsp;
					<span class="tags"><a href="../tag/devops/index.html">DevOps</a></span>
            	</div>
			</div>
        </header>

        <div class="text" id="js-post-content">
            <p>A few weeks back I published my <a href="http://iyware.com/qtranslate-jquery-missing-link/" title="qtranslate + jQuery Missing Link">qTranslate Missing Link</a> code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version” kind of 3.0 (I’m looking at you Firefox…). What I want to do now is show you revisions 1.0 and 2.0, and how I got them, and then on to the final 3.0. And believe it or not, there’s room (for someone else) to take it to a version 4.</p>

<p>First I needed to define my problem, and I needed to identify how I wanted to develop a fix for it. Defining the problem was easy, there were already threads at <a href="http://mysitemyway.com/">mysitemyway.com</a> saying that qTranslate didn’t translate the ‘Home’ link on their themes’ custom menus (which isn’t really mysitemyway’s fault) and there were threads over at the <a href="http://www.qianqin.de/qtranslate/">qTranslate</a> forums saying the same thing for lots of different themes. Now we were on the right track. What I needed to do now is decide how to fix it. The answer became clear almost straight away: <a href="http://jquery.com/">jQuery</a>, simply because that’s what WordPress uses, so I knew it would work.</p>

<p>Since I’ve never used jQuery before (I think I’ve mentioned I’m not a JS guy…) I spent most of the time with this version (1.0) reading jQuery docs, and actually this rev. took the longest to write. Sadly, it’s the ugliest and least pluggable. So here’s the code:</p>

<pre><code class="language-javascript">    if(jQuery('html').attr('lang') == 'zh-CN') {
        jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
            return val + 'zh'
        });
    }
</code></pre>

<p>You can see it’s a pretty static script, written specifically to take a single selector in a single language and modify it by appending ‘<code>zh</code>‘ to the end of the <code>href</code>. That “worked” until I needed it in multiple languages. Then I wrote version 2.0:</p>

<pre><code class="language-javascript">   switch(jQuery('html').attr('lang')) {
      case 'zh-CN': jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
                return val + 'zh/'
            });
            break;
      case 'ko-KR': jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
                return val + 'ko/'
            });
            break;
   }
</code></pre>

<p>Well now you can define multiple language, and we’re using a proper <code>switch</code> instead of <code>elif</code>s but still, what if you need multiple selectors per language? Enter version 3.0 (the one I released):</p>

<pre><code class="language-javascript">   jQuery.each(['#menu-top-menu &gt; li:first-child a'], function(index, value) {
        jQuery(value).attr('href', function(i, val) {
            return val + jQuery('html').attr('lang').split('-')[0]
        });   
    });
</code></pre>

<p>Now we’re talking. This will work for any language, because we’re parsing the actual value of the <code>lang</code> attribute and using that rather than hard coding it. And we’re using <code>jQuery.each</code> to instantiate an array. Not bad if I do say so myself.</p>

<p>So where would a version 3.1 or a version 4.0 go? Pretty simple answer really, v3.1 would optimize the query by evaluating the <code>lang</code> attribute outside of the loop rather than at every iteration, because it doesn’t change and it would optimize readability by instantiating the array outside of the <code>jQuery.each</code> function and then just call the variable. Version 4.0 would switch from using <code>jQuery.each</code> to using a <code>for</code> loop since that’s apparently <a href="http://net.tutsplus.com/tutorials/javascript-ajax/10-ways-to-instantly-increase-your-jquery-performance/">significantly faster</a>.</p>

<p>All of this is to say something that every programmer knows – no code is perfect and there’s always a different (and perhaps better) way to do something. So if I ever do get around to writing a version 4.0 of this script I might wrap it up in a WordPress extension so that any user can plug it into any theme and define the array themselves fixing everyone’s problems (with qTranslate…).</p>
            <!--sse-->
			<div id="disqus_thread"></div>
			<script type="text/javascript">
				var disqus_shortname = 'iyware';
				(function() {
					var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
					dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
					(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				})();
			</script>
			<noscript><p style="text-align:center;"><small>Please enable JavaScript to view the <a href="https://disqus.com/home/forums/iyware/">comments powered by Disqus.</a></small></p></noscript>
			<!--/sse-->
        </div>

        <footer class="post-footer" role="contentinfo">

            <div class="vcard">
                <a href="../rss/index.html" id="btn_feed" class="btn" title="Feed">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a>

                <a href="../index.html" class="photo">
                    <span style="background-image: url('../content/images/2015/01/me.jpg');">
                        <img src="../content/images/2015/01/me.jpg" alt="Danny Wahl">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="../index.html" class="url n">Danny Wahl</a></h4>
                    <!--sse--><span>danny &#64; iyware.com</span><br/><!--/sse-->
                    <span>License: <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span><br/>
                    
              
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    My name is Danny Wahl and I provide IT management and consulting in the APAC region. I dabble in writing, programming, design, and ukulele playing.
                </div>
            </div>

        </footer>

    </article>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<ins class="adsbygoogle" style="display:inline-block;width:320px;height:100px" data-ad-client="ca-pub-5811335018322110" data-ad-slot="8562617448"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>




    <script src="../public/jquerya8c1.js?v=81e7bb23cf"></script>

		<script type="text/javascript" src="../assets/js/prism.mina8c1.js?v=81e7bb23cf"></script>
	

	<aside style="display:none;">
		<a href="../search/index.html">Search</a>
		<a href="../clients/index.html">Clients</a>
	</aside>
</body>

<!-- Mirrored from localhost:2368/re-writing-good-code/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 04 Feb 2015 05:45:27 GMT -->
</html>