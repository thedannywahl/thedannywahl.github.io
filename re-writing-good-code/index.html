<!DOCTYPE html>
<html>

<!-- Mirrored from 127.0.0.1:2368/re-writing-good-code/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 12 Jan 2018 22:00:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>(Re-)Writing Good Code - iyWare</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.min2ce6.css?v=d0d73aecc2" />
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://iyware.com/re-writing-good-code/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="iyWare" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="(Re-)Writing Good Code" />
    <meta property="og:description" content="A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version” kind of 3.0 (I’" />
    <meta property="og:url" content="https://iyware.com/re-writing-good-code/" />
    <meta property="article:published_time" content="2011-11-05T14:39:53.000Z" />
    <meta property="article:modified_time" content="2015-01-19T03:13:04.000Z" />
    <meta property="article:tag" content="DevOps" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="(Re-)Writing Good Code" />
    <meta name="twitter:description" content="A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version” kind of 3.0 (I’" />
    <meta name="twitter:url" content="https://iyware.com/re-writing-good-code/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Danny Wahl" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="DevOps" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "iyWare",
        "logo": "https://iyware.com/content/images/2015/01/logo.png"
    },
    "author": {
        "@type": "Person",
        "name": "Danny Wahl",
        "image": {
            "@type": "ImageObject",
            "url": "https://iyware.com/content/images/2015/03/dannywahl.jpg",
            "width": 112,
            "height": 112
        },
        "url": "https://iyware.com/author/danny-2/",
        "sameAs": [
            "https://iyware.com"
        ]
    },
    "headline": "(Re-)Writing Good Code",
    "url": "https://iyware.com/re-writing-good-code/",
    "datePublished": "2011-11-05T14:39:53.000Z",
    "dateModified": "2015-01-19T03:13:04.000Z",
    "keywords": "DevOps",
    "description": "A few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version” kind of 3.0 (I’",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://iyware.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 1.20" />
    <link rel="alternate" type="application/rss+xml" title="iyWare" href="https://iyware.com/rss/" />
</head>
<body class="post-template tag-devops">
    

	<header role="banner" class="header-main no-image">
    		<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="https://iyware.com/">Home</a></li>
    <li class="nav-clients" role="menuitem"><a href="https://iyware.com/clients/">Clients</a></li>
    <li class="nav-portfolio" role="menuitem"><a href="https://iyware.com/tag/portfolio/">Portfolio</a></li>
    <li class="nav-search" role="menuitem"><a href="https://iyware.com/search/">Search</a></li>
</ul>

		<h1>
    		<a href="https://iyware.com/">
            		<img src="../content/images/2015/01/logo.png" alt="iyWare">
			</a>
		</h1>
	</header>

    <article role="main" class="post tag-devops">

        <header>
            <h1>(Re-)Writing Good Code</h1>

			<small class="meta">
						<a href="../author/danny-2/" class="author" style="background-image:url('../content/images/2015/03/dannywahl.jpg');"><img src="../content/images/2015/03/dannywahl.jpg" alt="Danny Wahl's picture"></a>
					<a href="../author/danny-2/">Danny Wahl</a>
				&nbsp;&bull;&nbsp;
				<time datetime="2011-11-05">November 05, 2011</time>
					&nbsp;&bull;&nbsp;
					<span class="tags"><a href="../tag/devops/">DevOps</a></span>
			</small>
        </header>

        <div class="text">
            <div class="kg-card-markdown"><p>A few weeks back I published my <a href="https://iyware.com/qtranslate-jquery-missing-link/" title="qtranslate + jQuery Missing Link">qTranslate Missing Link</a> code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version” kind of 3.0 (I’m looking at you Firefox…). What I want to do now is show you revisions 1.0 and 2.0, and how I got them, and then on to the final 3.0. And believe it or not, there’s room (for someone else) to take it to a version 4.</p>
<p>First I needed to define my problem, and I needed to identify how I wanted to develop a fix for it. Defining the problem was easy, there were already threads at <a href="http://mysitemyway.com/">mysitemyway.com</a> saying that qTranslate didn’t translate the ‘Home’ link on their themes’ custom menus (which isn’t really mysitemyway’s fault) and there were threads over at the <a href="http://www.qianqin.de/qtranslate/">qTranslate</a> forums saying the same thing for lots of different themes. Now we were on the right track. What I needed to do now is decide how to fix it. The answer became clear almost straight away: <a href="http://jquery.com/">jQuery</a>, simply because that’s what WordPress uses, so I knew it would work.</p>
<p>Since I’ve never used jQuery before (I think I’ve mentioned I’m not a JS guy…) I spent most of the time with this version (1.0) reading jQuery docs, and actually this rev. took the longest to write. Sadly, it’s the ugliest and least pluggable. So here’s the code:</p>
<pre><code class="language-language-javascript">    if(jQuery('html').attr('lang') == 'zh-CN') {
        jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
            return val + 'zh'
        });
    }
</code></pre>
<p>You can see it’s a pretty static script, written specifically to take a single selector in a single language and modify it by appending ‘<code>zh</code>‘ to the end of the <code>href</code>. That “worked” until I needed it in multiple languages. Then I wrote version 2.0:</p>
<pre><code class="language-language-javascript">   switch(jQuery('html').attr('lang')) {
      case 'zh-CN': jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
                return val + 'zh/'
            });
            break;
      case 'ko-KR': jQuery('#menu-top-menu &gt; li:first-child a').attr('href', function(i, val) {
                return val + 'ko/'
            });
            break;
   }
</code></pre>
<p>Well now you can define multiple language, and we’re using a proper <code>switch</code> instead of <code>elif</code>s but still, what if you need multiple selectors per language? Enter version 3.0 (the one I released):</p>
<pre><code class="language-language-javascript">   jQuery.each(['#menu-top-menu &gt; li:first-child a'], function(index, value) {
        jQuery(value).attr('href', function(i, val) {
            return val + jQuery('html').attr('lang').split('-')[0]
        });   
    });
</code></pre>
<p>Now we’re talking. This will work for any language, because we’re parsing the actual value of the <code>lang</code> attribute and using that rather than hard coding it. And we’re using <code>jQuery.each</code> to instantiate an array. Not bad if I do say so myself.</p>
<p>So where would a version 3.1 or a version 4.0 go? Pretty simple answer really, v3.1 would optimize the query by evaluating the <code>lang</code> attribute outside of the loop rather than at every iteration, because it doesn’t change and it would optimize readability by instantiating the array outside of the <code>jQuery.each</code> function and then just call the variable. Version 4.0 would switch from using <code>jQuery.each</code> to using a <code>for</code> loop since that’s apparently <a href="http://net.tutsplus.com/tutorials/javascript-ajax/10-ways-to-instantly-increase-your-jquery-performance/">significantly faster</a>.</p>
<p>All of this is to say something that every programmer knows – no code is perfect and there’s always a different (and perhaps better) way to do something. So if I ever do get around to writing a version 4.0 of this script I might wrap it up in a WordPress extension so that any user can plug it into any theme and define the array themselves fixing everyone’s problems (with qTranslate…).</p>
</div>
        </div>

        <section class="share">
					<small class="meta">Share this post</small>
        	<ul>
				<li>
					<a href="mailto:?&subject=iyWare%3A%20(Re-)Writing%20Good%20Code&body=(Re-)Writing%20Good%20Code%0D%0Ahttps://iyware.com/re-writing-good-code/%0D%0A%0D%0AA few weeks back I published my qTranslate Missing Link code, what I didn’t say in that post was that that was the 3rd revision of the code. And I mean a real v3.0, not a “let’s call it a new version”%2E%2E%2E">Email</a>
				</li>
				<li>
					<a href="https://twitter.com/home?status=https://iyware.com/re-writing-good-code/%20%23DevOps">Twitter</a>
				</li>
				<li>
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://iyware.com/re-writing-good-code/">Facebook</a>
				</li>
				<li>
					<a href="https://plus.google.com/share?url=https://iyware.com/re-writing-good-code/">Google+</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://iyware.com/re-writing-good-code/&amp;title=(Re-)Writing%20Good%20Code&amp;summary=A%20few%20weeks%20back%20I%20published%20my%20qTranslate%20Missing%20Link%20code,%20what%20I%20didn%e2%80%99t%20say%20in%20that%20post%20was%20that%20that%20was%20the%203rd%20revision%20of%20the%20code.%20And%20I%20mean%20a%20real%20v3.0,%20not%20a%20%e2%80%9clet%e2%80%99s%20call%20it%20a%20new%20version%e2%80%9d&amp;source=iyWare">LinkedIn</a>
				</li>
			</ul>
        </section>

        <footer class="post-footer vcard cf" role="contentinfo">
                	<div class="wrapper">
                	<a href="../author/danny-2/" class="author" style="background-image: url('../content/images/2015/03/dannywahl.jpg');">
                    	<img src="../content/images/2015/03/dannywahl.jpg" alt="Danny Wahl">
					</a>
					</div>
                <div class="author-info meta">
					<a href="../author/danny-2/" class="fn">Danny Wahl</a>
                    &nbsp;&bull;&nbsp;<span class="adr">天津</span>
                    &nbsp;&bull;&nbsp;<a class="site" href="https://iyware.com/">https://iyware.com</a>
                    <p class="bio">My name is Danny Wahl and I provide consulting in IT and education. I dabble in writing, programming, design, and ukulele playing. Post content licensed CC-BY-4.0</p>
                </div>
        </footer>

    </article>


<footer class="footer-main cf">
	<p class="feed"><a href="../rss/">RSS Feed</a></p>
	<p class="description">
        <a class="title" href="../">iyWare</a>
        <span>Things I Break</span>
    </p>
	<p class="copyright">&copy; 2018 <a href="../">iyWare</a></p>
</footer>

    <script type="text/javascript" async defer>document.body.className.match("post-template")&&(prismcss=document.createElement("link"),prismcss.rel="stylesheet",prismcss.href="../assets/css/prism.min.css",document.body.appendChild(prismcss),prismjs=document.createElement("script"),prismjs.type="text/javascript",prismjs.async=!0,prismjs.onload=function(){},prismjs.src="https://cdn.jsdelivr.net/npm/prismjs@1.9.0/prism.min.js",document.body.appendChild(prismjs),disqushtml=document.createElement("div"),disqushtml.id="disqus_thread",document.getElementsByTagName("article")[0].appendChild(disqushtml),disqusjs=document.createElement("script"),disqusjs.type="text/javascript",disqusjs.async=!0,disqusjs.src="https://iyware.disqus.com/embed.js",document.body.appendChild(disqusjs)),function(s,e,t,i,m,n,c){s.SwiftypeObject=m,s[m]=s[m]||function(){(s[m].q=s[m].q||[]).push(arguments)},n=e.createElement(t),c=e.getElementsByTagName(t)[0],n.async=1,n.src=i,c.parentNode.insertBefore(n,c)}(window,document,"script","https://s.swiftypecdn.com/install/v2/st.js","_st"),_st("install","UpLojaav5s--stgt7FKu","2.0.0");</script>
</body>

<!-- Mirrored from 127.0.0.1:2368/re-writing-good-code/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 12 Jan 2018 22:00:17 GMT -->
</html>
